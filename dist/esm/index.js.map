{
  "version": 3,
  "sources": ["../../lib/createBaseConvexSlice.js", "../../lib/create.js"],
  "sourcesContent": ["import { BaseConvexClient } from \"convex/browser\";\n\nexport function createBaseConvexSlice() {\n\n  // Subscription manager outside the store\n  const subscriptions = new Map();\n  let client = null;\n\n  return (set, get) => {\n    const onTransition = function(updatedQueryTokens) {\n      const state = get();\n      const { queries } = state;\n      let nextQueries = queries;\n\n      for (const queryToken of updatedQueryTokens) {\n        const sub = subscriptions.get(queryToken);\n        if (!sub) continue;\n        nextQueries = {\n          ...nextQueries,\n          [queryToken]: client.localQueryResult(sub.name, sub.args),\n        };\n      }\n\n      set({ queries: nextQueries });\n    };\n\n    return {\n      queries: {},\n\n      connect(convexUrl) {\n        if (client) {\n          throw new Error('Already connected to Convex');\n        }\n        client = new BaseConvexClient(convexUrl, onTransition);\n      },\n\n      subscribe: function(name, args = {}, placeholder = null) {\n        if (!client) {\n          throw new Error('Not connected. Call connect(convexUrl) first');\n        }\n\n        const key = `${name}:${JSON.stringify(args || {})}`;\n\n        // Check if subscription already exists\n        for (const [queryToken, sub] of subscriptions) {\n          if (sub.key === key) {\n            return (state) => state.queries[queryToken] || placeholder;\n          }\n        }\n\n        // Create new subscription without mutating store\n        const { queryToken, unsubscribe } = client.subscribe(name, args);\n        subscriptions.set(queryToken, { name, args, key, unsubscribe });\n\n        return (state) => state.queries[queryToken] || placeholder;\n      },\n\n      async mutation(name, args = {}) {\n        if (!client) {\n          throw new Error('Not connected. Call connect(convexUrl) first');\n        }\n        await client.mutation(name, args);\n      },\n\n      getClient() {\n        if (!client) {\n          throw new Error('Not connected. Call connect(convexUrl) first');\n        }\n        return client;\n      }\n    };\n  };\n}", "import { create as zustandCreate } from 'zustand'\nimport { createBaseConvexSlice } from './createBaseConvexSlice.js'\n\nexport function create(initializer) {\n  // Create the convex slice first (no connection yet)\n  const convexSlice = createBaseConvexSlice()\n\n  // Create the Zustand store with both user state and convex slice\n  const useStore = zustandCreate((set, get) => {\n    const convexState = convexSlice(set, get)\n    const userState = typeof initializer === 'function' ? initializer(set, get) : initializer || {}\n\n    return {\n      ...userState,\n      ...convexState  // Convex methods take precedence to prevent user override\n    }\n  })\n\n  // Add connect method to the store hook\n  useStore.connect = function(convexUrl) {\n    const state = useStore.getState()\n    state.connect(convexUrl)\n    return useStore\n  }\n\n  return useStore\n}\n\nexport default create\n"],
  "mappings": ";AAAA,SAAS,wBAAwB;AAE1B,SAAS,wBAAwB;AAGtC,QAAM,gBAAgB,oBAAI,IAAI;AAC9B,MAAI,SAAS;AAEb,SAAO,CAAC,KAAK,QAAQ;AACnB,UAAM,eAAe,SAAS,oBAAoB;AAChD,YAAM,QAAQ,IAAI;AAClB,YAAM,EAAE,QAAQ,IAAI;AACpB,UAAI,cAAc;AAElB,iBAAW,cAAc,oBAAoB;AAC3C,cAAM,MAAM,cAAc,IAAI,UAAU;AACxC,YAAI,CAAC,IAAK;AACV,sBAAc;AAAA,UACZ,GAAG;AAAA,UACH,CAAC,UAAU,GAAG,OAAO,iBAAiB,IAAI,MAAM,IAAI,IAAI;AAAA,QAC1D;AAAA,MACF;AAEA,UAAI,EAAE,SAAS,YAAY,CAAC;AAAA,IAC9B;AAEA,WAAO;AAAA,MACL,SAAS,CAAC;AAAA,MAEV,QAAQ,WAAW;AACjB,YAAI,QAAQ;AACV,gBAAM,IAAI,MAAM,6BAA6B;AAAA,QAC/C;AACA,iBAAS,IAAI,iBAAiB,WAAW,YAAY;AAAA,MACvD;AAAA,MAEA,WAAW,SAAS,MAAM,OAAO,CAAC,GAAG,cAAc,MAAM;AACvD,YAAI,CAAC,QAAQ;AACX,gBAAM,IAAI,MAAM,8CAA8C;AAAA,QAChE;AAEA,cAAM,MAAM,GAAG,IAAI,IAAI,KAAK,UAAU,QAAQ,CAAC,CAAC,CAAC;AAGjD,mBAAW,CAACA,aAAY,GAAG,KAAK,eAAe;AAC7C,cAAI,IAAI,QAAQ,KAAK;AACnB,mBAAO,CAAC,UAAU,MAAM,QAAQA,WAAU,KAAK;AAAA,UACjD;AAAA,QACF;AAGA,cAAM,EAAE,YAAY,YAAY,IAAI,OAAO,UAAU,MAAM,IAAI;AAC/D,sBAAc,IAAI,YAAY,EAAE,MAAM,MAAM,KAAK,YAAY,CAAC;AAE9D,eAAO,CAAC,UAAU,MAAM,QAAQ,UAAU,KAAK;AAAA,MACjD;AAAA,MAEA,MAAM,SAAS,MAAM,OAAO,CAAC,GAAG;AAC9B,YAAI,CAAC,QAAQ;AACX,gBAAM,IAAI,MAAM,8CAA8C;AAAA,QAChE;AACA,cAAM,OAAO,SAAS,MAAM,IAAI;AAAA,MAClC;AAAA,MAEA,YAAY;AACV,YAAI,CAAC,QAAQ;AACX,gBAAM,IAAI,MAAM,8CAA8C;AAAA,QAChE;AACA,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AACF;;;ACxEA,SAAS,UAAU,qBAAqB;AAGjC,SAAS,OAAO,aAAa;AAElC,QAAM,cAAc,sBAAsB;AAG1C,QAAM,WAAW,cAAc,CAAC,KAAK,QAAQ;AAC3C,UAAM,cAAc,YAAY,KAAK,GAAG;AACxC,UAAM,YAAY,OAAO,gBAAgB,aAAa,YAAY,KAAK,GAAG,IAAI,eAAe,CAAC;AAE9F,WAAO;AAAA,MACL,GAAG;AAAA,MACH,GAAG;AAAA;AAAA,IACL;AAAA,EACF,CAAC;AAGD,WAAS,UAAU,SAAS,WAAW;AACrC,UAAM,QAAQ,SAAS,SAAS;AAChC,UAAM,QAAQ,SAAS;AACvB,WAAO;AAAA,EACT;AAEA,SAAO;AACT;AAEA,IAAO,iBAAQ;",
  "names": ["queryToken"]
}
